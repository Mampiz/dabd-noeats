---
// Importamos los tipos y componentes necesarios
import type {Plato} from "../types/apiusers.ts";
import CardPlato from "./CardPlato.astro";

// Función para obtener los datos de un solo plato
async function fetchPlato(): Promise<Plato | null> {
	const nom = Astro.params.nom;
	const apiURL = `/platos/${nom}`;
	const response = await fetch("http://localhost:3000" + apiURL, {
		method: "GET"
	});
	if (response.ok) {
		return response.json();
	} else {
		console.error("Error fetching plato:", response.statusText);
		return null;
	}
}

// Inicializamos plato con null para asegurar que siempre esté definida
let plato: Plato | null = null;
try {
	plato = await fetchPlato();
	if (!plato) {
		console.error("Error: No se pudo obtener el plato");
	}
} catch (error) {
	console.error("Error fetching plato:", error);
}
console.log(plato);
---

<div class="w-full h-screen flex justify-center items-center">
	{plato ? <CardPlato nom={plato.nom} descripcio={plato.descripcio} preu={plato.preu} /> : <p>No se pudo cargar la información del plato.</p>}
</div>
